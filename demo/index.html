<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>WebTools</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src="../public/toolbox.bundle.js"></script>

    <link rel="stylesheet" href="style.css">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&" as="style" onload="this.onload=null;this.rel='stylesheet'">
</head>
<body>
    <header>
    <h1>WebTools ‚Äî Documentation & Mini demo</h1>
    </header>

    <main>
        <nav id="nav">
            <a href="#ContextMenu" class="item">ContextMenu</a>
            <a href="#DataTable" class="item">DataTable</a>
            <a href="#EditableText" class="item">EditableText</a>
            <a href="#LoadingScreen" class="item">LoadingScreen</a>
            <a href="#Navigator" class="item">Navigator</a>
            <a href="#PopUp" class="item">PopUp</a>
            <a href="#Toast" class="item">Toast</a>
        </nav>

        <div id="content">
            <!-- ContextMenu -->
            <section id="ContextMenu" class="active">
            <div class="card">
                <h2>ContextMenu</h2>

                <div id="context-menu-demo">
                    <p class="muted">Right click in the following zone.</p>
                    <div id="cm-area" class="card" style="height:160px; display:flex; align-items:center; justify-content:center; border-color: var(--accent);">
                        Contextual zone
                    </div>
                    <br/>
                    <br/>

                    <h3>JS used for this exemple</h3>
                    <div class="block-js">
                        <span class="js-const">const</span> context_menu_demo = <span class="js-keyword">new</span> <span class="js-object">ContextMenu</span>({
                        <br>&nbsp;&nbsp;activation: <span class="js-string">'contextmenu'</span>,
                        <br>&nbsp;&nbsp;mode: <span class="js-string">'selector'</span>,
                        <br>&nbsp;&nbsp;selector: <span class="js-string">'#cm-area'</span>,
                        <br>
                        <br>&nbsp;&nbsp;<span class="js-comment">// Enrich the callback context with useful data</span>
                        <br>&nbsp;&nbsp;context_fn: (event, element) =&gt; ({ 
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;id: element.id, 
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;name: element.name 
                        <br>&nbsp;&nbsp;})
                        <br>});
                        <br><br>
                        context_menu_demo
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Cut'</span>, () =&gt; document.execCommand(<span class="js-string">'cut'</span>))
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Copy'</span>, () =&gt; document.execCommand(<span class="js-string">'copy'</span>))
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Paste'</span>, () =&gt; document.execCommand(<span class="js-string">'paste'</span>))
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Select All'</span>, () =&gt; document.execCommand(<span class="js-string">'selectAll'</span>));
                    </div>
                </div>

                <hr style="border-color: var(--darker-text);"/>

                <div id="context-menu-instantiation">
                    <h3>Instantiation</h3>

                    <h4>Open on right-click anywhere in the page</h4>
                    <div class="block-js">
                        <span class="js-const">const</span> menu = <span class="js-keyword">new</span> <span class="js-class">ContextMenu</span>({
                        <br>&nbsp;&nbsp;activation: <span class="js-string">'contextmenu'</span>,
                        <br>&nbsp;&nbsp;mode: <span class="js-string">'always'</span>
                        <br>});
                    </div>

                    <p>
                        The menu opens for <strong>any activation event</strong> inside the container
                        (default: <code>document</code>).
                    </p>
                    <ul>
                        <li><code>ctx.target</code> is the original event target</li>
                        <li>Useful for global context menus</li>
                    </ul>

                    <br/>

                    <h4>Open only when right-clicking specific elements</h4>
                    <div class="block-js">
                        <span class="js-const">const</span> menu = <span class="js-keyword">new</span> <span class="js-class">ContextMenu</span>({
                        <br>&nbsp;&nbsp;activation: <span class="js-string">'contextmenu'</span>,
                        <br>&nbsp;&nbsp;mode: <span class="js-string">'selector'</span>,
                        <br>&nbsp;&nbsp;selector: <span class="js-string">'[data-menu="context-menu"]'</span>,
                        <br>});
                    </div>

                    <p>
                        The menu opens <strong>only if</strong>
                        <code>event.target.closest(selector)</code> returns an element.
                    </p>
                    <ul>
                        <li><code>ctx.target</code> is the matched element (not just the child you clicked)</li>
                        <li>
                        Use <code>context_fn(event, matchedElement)</code> to pass
                        domain-specific data
                        </li>
                        <li>Perfect for item-specific menus</li>
                    </ul>
                </div>

                <div id="fluent-api">
                    <h3>Fluent API</h3>
                    <div class="block-js">
                        <span class="js-var js-var-def">fileMenu</span>
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Open'</span>, ({data}) =&gt; <span class="js-func">openFile</span>(data.id))
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Rename'</span>, ({data}) =&gt; <span class="js-func">renameFile</span>(data.id))
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">check</span>(<span class="js-string">'Pinned'</span>,
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;({data}) =&gt; <span class="js-func">isPinned</span>(data.id),&nbsp;&nbsp;<span class="js-comment">// Initial state</span>
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;(checked, {data}) =&gt; <span class="js-func">setPinned</span>(data.id, checked)&nbsp;&nbsp;<span class="js-comment">// Toggle handler</span>
                        <br>);
                    </div>
                    </div>

                    <div id="action-options">
                    <h3>Action Options</h3>
                    <div class="block-js">
                        <span class="js-var">fileMenu</span>.<span class="js-func">action</span>(<span class="js-string">'Delete'</span>, ({data}) =&gt; <span class="js-func">deleteFile</span>(data.id), {
                        <br>&nbsp;&nbsp;visible: ({data}) =&gt; data.type !== <span class="js-string">'folder'</span>,&nbsp;&nbsp;<span class="js-comment">// Hide item if false</span>
                        <br>&nbsp;&nbsp;enabled: ({data}) =&gt; !<span class="js-func">isProtected</span>(data.id),&nbsp;&nbsp;<span class="js-comment">// Disable if false</span>
                        <br>&nbsp;&nbsp;icon_html: <span class="js-string">'üóëÔ∏è'</span>,&nbsp;&nbsp;<span class="js-comment">// Optional icon HTML</span>
                        <br>&nbsp;&nbsp;danger: <span class="js-keyword">true</span>&nbsp;&nbsp;<span class="js-comment">// Red-ish hover style</span>
                        <br>});
                    </div>
                    </div>

                    <div id="context-object">
                    <h3>Context Object</h3>
                    <p>Every handler receives a context object with:</p>
                    <div class="block-js">
                        {
                        <br>&nbsp;&nbsp;<span class="js-var">event</span>,&nbsp;&nbsp;<span class="js-comment">// Original DOM event</span>
                        <br>&nbsp;&nbsp;<span class="js-var">target</span>,&nbsp;&nbsp;<span class="js-comment">// Matched element (selector mode) or event target (always mode)</span>
                        <br>&nbsp;&nbsp;<span class="js-var">data</span>,&nbsp;&nbsp;<span class="js-comment">// Shorthand for target.dataset</span>
                        <br>&nbsp;&nbsp;...<span class="js-func">context_fn</span>()&nbsp;&nbsp;<span class="js-comment">// Any extra fields you injected via context_fn</span>
                        <br>}
                    </div>
                    </div>

                    <div id="advanced-usage">
                    <h3>üéØ Advanced Usage</h3>

                    <div id="manual-triggering">
                        <h4>Manual Triggering</h4>
                        <div class="block-js">
                        <span class="js-comment">// Open at specific coordinates</span>
                        <br><span class="js-var">button</span>.<span class="js-func">addEventListener</span>(<span class="js-string">'click'</span>, (e) =&gt; {
                        <br>&nbsp;&nbsp;<span class="js-const">const</span> ctx = { <span class="js-var">from</span>: <span class="js-string">'button'</span>, <span class="js-var">id</span>: <span class="js-var">button</span>.<span class="js-var">dataset</span>.<span class="js-var">id</span> };
                        <br>&nbsp;&nbsp;<span class="js-var">fileMenu</span>.<span class="js-func">open_at</span>(e.<span class="js-var">clientX</span>, e.<span class="js-var">clientY</span>, ctx);
                        <br>});
                        <br>
                        <br><span class="js-comment">// Handle events directly</span>
                        <br><span class="js-var">container</span>.<span class="js-func">addEventListener</span>(<span class="js-string">'contextmenu'</span>, (e) =&gt; {
                        <br>&nbsp;&nbsp;<span class="js-var">fileMenu</span>.<span class="js-func">open_for_event</span>(e);
                        <br>});
                        </div>
                    </div>

                    <div id="mobile-long-press">
                        <h4>Mobile Long-Press Support</h4>
                        <div class="block-js">
                        <span class="js-func">function</span> <span class="js-func">longPress</span>(element, callback, duration = <span class="js-number">500</span>) {
                        <br>&nbsp;&nbsp;<span class="js-const">let</span> timeout = <span class="js-keyword">null</span>;
                        <br>&nbsp;&nbsp;element.<span class="js-func">addEventListener</span>(<span class="js-string">'touchstart'</span>, (e) =&gt; {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;timeout = <span class="js-func">setTimeout</span>(() =&gt; callback(e.<span class="js-var">touches</span>[<span class="js-number">0</span>]), duration);
                        <br>&nbsp;&nbsp;}, { passive: <span class="js-keyword">true</span> });
                        <br>&nbsp;&nbsp;[<span class="js-string">'touchend'</span>, <span class="js-string">'touchmove'</span>, <span class="js-string">'touchcancel'</span>].<span class="js-func">forEach</span>(eventType =&gt; {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;element.<span class="js-func">addEventListener</span>(eventType, () =&gt; {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-func">clearTimeout</span>(timeout);
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;}, { passive: <span class="js-keyword">true</span> });
                        <br>&nbsp;&nbsp;});
                        <br>}
                        <br>
                        <br><span class="js-comment">// Apply long-press to open context menu</span>
                        <br><span class="js-func">longPress</span>(<span class="js-class">document</span>, (touch) =&gt; {
                        <br>&nbsp;&nbsp;<span class="js-var">fileMenu</span>.<span class="js-func">open_at</span>(touch.<span class="js-var">clientX</span>, touch.<span class="js-var">clientY</span>, { <span class="js-var">from</span>: <span class="js-string">'touch'</span> });
                        <br>});
                        </div>
                    </div>

                    <div id="dynamic-menu-updates">
                        <h4>Dynamic Menu Updates</h4>
                        <div class="block-js">
                        <span class="js-comment">// Replace all items</span>
                        <br><span class="js-var">fileMenu</span>.<span class="js-func">set_items</span>([]);
                        <br>
                        <br><span class="js-comment">// Rebuild menu</span>
                        <br><span class="js-var">fileMenu</span>
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Refresh'</span>, () =&gt; <span class="js-var">location</span>.<span class="js-func">reload</span>())
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'About'</span>, () =&gt; <span class="js-func">showAbout</span>());
                        <br>
                        <br><span class="js-comment">// Control visibility</span>
                        <br><span class="js-var">fileMenu</span>.<span class="js-func">close</span>();&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-comment">// Hide if open</span>
                        <br><span class="js-var">fileMenu</span>.<span class="js-func">destroy</span>(); <span class="js-comment">// Remove DOM and event listeners</span>
                        </div>
                    </div>
                    </div>

                    <div id="api-reference">
                    <h3>üìù API Reference</h3>

                    <div id="constructor-options">
                        <h4>Constructor Options</h4>
                        <div class="block-js">
                        <span class="js-keyword">interface</span> <span class="js-class">ContextMenuOptions</span> {
                        <br>&nbsp;&nbsp;<span class="js-var">activation</span>?: <span class="js-class">string</span> | <span class="js-class">string</span>[];&nbsp;&nbsp;<span class="js-comment">// 'contextmenu' | 'click' | etc.</span>
                        <br>&nbsp;&nbsp;<span class="js-var">mode</span>?: <span class="js-string">'always'</span> | <span class="js-string">'selector'</span>;&nbsp;&nbsp;<span class="js-comment">// Targeting mode</span>
                        <br>&nbsp;&nbsp;<span class="js-var">selector</span>?: <span class="js-class">string</span>;&nbsp;&nbsp;<span class="js-comment">// CSS selector (required for 'selector' mode)</span>
                        <br>&nbsp;&nbsp;<span class="js-var">container</span>?: <span class="js-class">Document</span> | <span class="js-class">HTMLElement</span>;&nbsp;&nbsp;<span class="js-comment">// Event container (default: document)</span>
                        <br>&nbsp;&nbsp;<span class="js-var">items</span>?: <span class="js-class">MenuItem</span>[];&nbsp;&nbsp;<span class="js-comment">// Initial menu items</span>
                        <br>&nbsp;&nbsp;<span class="js-var">context_fn</span>?: (event: <span class="js-class">Event</span>, target: <span class="js-class">Element</span> | <span class="js-keyword">null</span>) =&gt; <span class="js-class">object</span>;
                        <br>}
                        </div>
                    </div>

                    <div id="fluent-api-methods">
                        <h4>Fluent API Methods</h4>
                        <table>
                        <thead>
                            <tr><th>Method</th><th>Description</th></tr>
                        </thead>
                        <tbody>
                            <tr><td><code>action(label, onClick, options?)</code></td><td>Add an action item</td></tr>
                            <tr><td><code>check(label, getChecked, onToggle, options?)</code></td><td>Add a checkbox item</td></tr>
                            <tr><td><code>sep()</code></td><td>Add a separator</td></tr>
                            <tr><td><code>set_items(items[])</code></td><td>Replace all menu items</td></tr>
                            <tr><td><code>open_for_event(event)</code></td><td>Open menu for a specific event</td></tr>
                            <tr><td><code>open_at(x, y, context?)</code></td><td>Open menu at coordinates</td></tr>
                            <tr><td><code>close()</code></td><td>Close the menu if open</td></tr>
                            <tr><td><code>destroy()</code></td><td>Remove menu and cleanup</td></tr>
                        </tbody>
                        </table>
                    </div>

                    <div id="item-options">
                        <h4>Item Options</h4>
                        <div class="block-js">
                        <span class="js-keyword">interface</span> <span class="js-class">ItemOptions</span> {
                        <br>&nbsp;&nbsp;<span class="js-var">visible</span>?: (context) =&gt; <span class="js-class">boolean</span>;&nbsp;&nbsp;<span class="js-comment">// Show/hide condition</span>
                        <br>&nbsp;&nbsp;<span class="js-var">enabled</span>?: (context) =&gt; <span class="js-class">boolean</span>;&nbsp;&nbsp;<span class="js-comment">// Enable/disable condition</span>
                        <br>&nbsp;&nbsp;<span class="js-var">icon_html</span>?: <span class="js-class">string</span>;&nbsp;&nbsp;<span class="js-comment">// HTML for icon (SVG, emoji, etc.)</span>
                        <br>&nbsp;&nbsp;<span class="js-var">danger</span>?: <span class="js-class">boolean</span>;&nbsp;&nbsp;<span class="js-comment">// Apply danger styling</span>
                        <br>}
                        </div>
                    </div>
                    </div>

                    <div id="styling">
                    <h3>üé® Styling</h3>
                    <p>The context menu uses CSS classes that you can customize:</p>
                    <div class="block-css">
                    <span class="css-selector">.context-menu</span> {
                    <span class="css-property">/* Menu container */</span>
                    }
                    <br><span class="css-selector">.context-menu-item</span> {
                    <span class="css-property">/* Menu item */</span>
                    }
                    <br><span class="css-selector">.context-menu-item.danger</span> {
                    <span class="css-property">/* Danger item styling */</span>
                    }
                    <br><span class="css-selector">.context-menu-item.disabled</span> {
                    <span class="css-property">/* Disabled item styling */</span>
                    }
                    <br><span class="css-selector">.context-menu-separator</span> {
                    <span class="css-property">/* Separator styling */</span>
                    }
                    </div>
                    </div>

                    <div id="examples">
                    <h3>üåü Examples</h3>

                    <div id="example-file-manager">
                        <h4>File Manager Context Menu</h4>
                        <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">fileMenu</span> = <span class="js-keyword">new</span> <span class="js-class">ContextMenu</span>({
                        <br>&nbsp;&nbsp;activation: <span class="js-string">'contextmenu'</span>,
                        <br>&nbsp;&nbsp;mode: <span class="js-string">'selector'</span>,
                        <br>&nbsp;&nbsp;selector: <span class="js-string">'.file-item'</span>,
                        <br>&nbsp;&nbsp;context_fn: (e, el) =&gt; ({
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;id: el.dataset.fileId,
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;type: el.dataset.fileType,
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;name: el.dataset.fileName
                        <br>&nbsp;&nbsp;})
                        <br>});
                        <br>
                        <br><span class="js-var">fileMenu</span>
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Open'</span>, ({data}) =&gt; <span class="js-func">openFile</span>(data.id))
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Download'</span>, ({data}) =&gt; <span class="js-func">downloadFile</span>(data.id))
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Rename'</span>, ({data}) =&gt; <span class="js-func">renameFile</span>(data.id))
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Move'</span>, ({data}) =&gt; <span class="js-func">moveFile</span>(data.id))
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">check</span>(<span class="js-string">'Starred'</span>,
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;({data}) =&gt; <span class="js-func">isStarred</span>(data.id),
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;(starred, {data}) =&gt; <span class="js-func">setStarred</span>(data.id, starred)
                        <br>&nbsp;&nbsp;)
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Delete'</span>, ({data}) =&gt; <span class="js-func">deleteFile</span>(data.id), {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;icon_html: <span class="js-string">'üóëÔ∏è'</span>,
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;danger: <span class="js-keyword">true</span>,
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;enabled: ({data}) =&gt; data.type !== <span class="js-string">'system'</span>
                        <br>&nbsp;&nbsp;});
                        </div>
                    </div>

                    <div id="example-text-editor">
                        <h4>Text Editor Context Menu</h4>
                        <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">editorMenu</span> = <span class="js-keyword">new</span> <span class="js-class">ContextMenu</span>({
                        <br>&nbsp;&nbsp;activation: <span class="js-string">'contextmenu'</span>,
                        <br>&nbsp;&nbsp;mode: <span class="js-string">'always'</span>,
                        <br>&nbsp;&nbsp;container: <span class="js-class">document</span>.<span class="js-func">querySelector</span>(<span class="js-string">'.editor'</span>)
                        <br>});
                        <br>
                        <br><span class="js-var">editorMenu</span>
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Cut'</span>, () =&gt; <span class="js-class">document</span>.<span class="js-func">execCommand</span>(<span class="js-string">'cut'</span>), {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;enabled: () =&gt; !<span class="js-class">document</span>.<span class="js-func">getSelection</span>().<span class="js-func">isCollapsed</span>
                        <br>&nbsp;&nbsp;})
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Copy'</span>, () =&gt; <span class="js-class">document</span>.<span class="js-func">execCommand</span>(<span class="js-string">'copy'</span>), {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;enabled: () =&gt; !<span class="js-class">document</span>.<span class="js-func">getSelection</span>().<span class="js-func">isCollapsed</span>
                        <br>&nbsp;&nbsp;})
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Paste'</span>, () =&gt; <span class="js-class">document</span>.<span class="js-func">execCommand</span>(<span class="js-string">'paste'</span>))
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Select All'</span>, () =&gt; <span class="js-class">document</span>.<span class="js-func">execCommand</span>(<span class="js-string">'selectAll'</span>))
                        <br>&nbsp;&nbsp;.<span class="js-func">sep</span>()
                        <br>&nbsp;&nbsp;.<span class="js-func">action</span>(<span class="js-string">'Find...'</span>, () =&gt; <span class="js-func">showFindDialog</span>(), {
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;icon_html: <span class="js-string">'üîç'</span>
                        <br>&nbsp;&nbsp;});
                        </div>
                    </div>
                    </div>

            </div>
            </section>

            <!-- DataTable -->
            <section id="DataTable">
            <div class="card">
                <h2>DataTable</h2>
                <div id="datatable-mount"></div>
                <div class="row">
                <button id="dt-reload">Recharger</button>
                <span class="muted">Exemple minimal avec donn√©es mock.</span>
                </div>
            </div>
            </section>

            <!-- EditableText -->
            <section id="EditableText">
            <div class="card">
                <h2>EditableText</h2>
                <div id="editable-mount">
                    <div></div>
                    <p class="muted"><b>Double-click</b> to edit. Press <b>Enter</b> to save, <b>Esc</b> to cancel.</p>
                </div>

                  <div id="quick-start">
                    <h3>üöÄ Quick Start</h3>
                    <div class="block-js">
                    <span class="js-const">const</span> nameField = <span class="js-keyword">new</span> <span class="js-class">EditableText</span>({
                    <br>&nbsp;&nbsp;value: <span class="js-string">'My Document'</span>,
                    <br>&nbsp;&nbsp;tag: <span class="js-string">'h2'</span>,
                    <br>&nbsp;&nbsp;on_save: (value, instance) =&gt; <span class="js-func">saveFileName</span>(fileId, value)
                    <br>});
                    <br>
                    <br><span class="js-comment">// Direct insertion into template strings</span>
                    <br><span class="js-class">document</span>.<span class="js-func">querySelector</span>(<span class="js-string">'.header'</span>).<span class="js-var">innerHTML</span> = `
                    <br>&nbsp;&nbsp;${source}
                    <br>&nbsp;&nbsp;${nameField}
                    <br>`;
                    </div>
                </div>

                <div id="user-interaction">
                    <h3>üéØ User Interaction</h3>
                    <ul>
                    <li><strong>Double-click</strong> to enter edit mode (focus + select all)</li>
                    <li><strong>Enter</strong> or <strong>blur</strong> to save (calls <code>on_save</code>)</li>
                    <li><strong>Escape</strong> to cancel (calls <code>on_cancel</code>)</li>
                    <li>Empty or unchanged values are ignored and revert</li>
                    </ul>
                </div>

                <hr style="border-color: var(--darker-text);"/>

                <div id="api">
                    <h3>üîß API</h3>

                    <h4>Constructor</h4>
                    <div class="block-js">
                    <span class="js-keyword">new</span> <span class="js-class">EditableText</span>({
                    <br>&nbsp;&nbsp;value: <span class="js-class">string</span>,&nbsp;&nbsp;<span class="js-comment">// Initial content</span>
                    <br>&nbsp;&nbsp;tag?: <span class="js-class">string</span>,&nbsp;&nbsp;<span class="js-comment">// 'h1'..'h6'|'span'|'div' (default: 'h2')</span>
                    <br>&nbsp;&nbsp;id?: <span class="js-class">string</span>,&nbsp;&nbsp;<span class="js-comment">// Auto-generated if not provided</span>
                    <br>&nbsp;&nbsp;on_save?: (value, instance) =&gt; <span class="js-class">void</span>|<span class="js-class">Promise</span>,
                    <br>&nbsp;&nbsp;on_cancel?: (instance) =&gt; <span class="js-class">void</span>
                    <br>})
                    </div>

                    <h4>HTML Output</h4>
                    <p><code>String(instance)</code> returns complete HTML ready for template insertion:</p>
                    <div class="block-html">
                    &lt;h2 class="editable-text"&gt;<br>
                    &nbsp;&nbsp;Content<br>
                    &lt;/h2&gt;
                    </div>
                </div>

                <div id="examples">
                    <h3>üìñ Examples</h3>

                    <h4>Basic Usage</h4>
                    <div class="block-js">
                    <span class="js-const">const</span> titleField = <span class="js-keyword">new</span> <span class="js-class">EditableText</span>({
                    <br>&nbsp;&nbsp;value: <span class="js-class">document</span>.<span class="js-var">title</span>,
                    <br>&nbsp;&nbsp;tag: <span class="js-string">'h1'</span>,
                    <br>&nbsp;&nbsp;on_save: <span class="js-keyword">async</span> (newTitle) =&gt; {
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">await</span> <span class="js-func">fetch</span>(<span class="js-string">'/api/title'</span>, { 
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;method: <span class="js-string">'POST'</span>, 
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: <span class="js-class">JSON</span>.<span class="js-func">stringify</span>({ title: newTitle }) 
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;});
                    <br>&nbsp;&nbsp;}
                    <br>});
                    </div>

                    <h4>Error Handling</h4>
                    <div class="block-js">
                    <span class="js-const">const</span> field = <span class="js-keyword">new</span> <span class="js-class">EditableText</span>({
                    <br>&nbsp;&nbsp;value: <span class="js-string">'filename.txt'</span>,
                    <br>&nbsp;&nbsp;on_save: <span class="js-keyword">async</span> (value) =&gt; {
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">if</span> (!<span class="js-func">isValidFileName</span>(value)) {
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">throw</span> <span class="js-keyword">new</span> <span class="js-class">Error</span>(<span class="js-string">'Invalid filename'</span>); <span class="js-comment">// Triggers automatic revert</span>
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;}
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="js-keyword">await</span> <span class="js-func">saveFile</span>(value);
                    <br>&nbsp;&nbsp;}
                    <br>});
                    </div>

                    <h4>Multiple Instances</h4>
                    <div class="block-js">
                    <span class="js-const">const</span> contact = {
                    <br>&nbsp;&nbsp;name: <span class="js-keyword">new</span> <span class="js-class">EditableText</span>({ value: <span class="js-string">'John Doe'</span>, tag: <span class="js-string">'h3'</span> }),
                    <br>&nbsp;&nbsp;title: <span class="js-keyword">new</span> <span class="js-class">EditableText</span>({ value: <span class="js-string">'Developer'</span>, tag: <span class="js-string">'span'</span> })
                    <br>};
                    <br>
                    <br><span class="js-var">element</span>.<span class="js-var">innerHTML</span> = `
                    <br>&nbsp;&nbsp;${contact.name}
                    <br>&nbsp;&nbsp;${contact.title}
                    <br>`;
                    </div>
                </div>

                <div id="css-classes">
                    <h3>üé® CSS Classes</h3>
                    <div class="block-css">
                    <span class="css-selector">.editable-text</span>              <span class="css-comment">/* Container */</span>
                    <br><span class="css-selector">.editable-text .view</span>        <span class="css-comment">/* Display mode */</span>
                    <br><span class="css-selector">.editable-text .edit</span>        <span class="css-comment">/* Input mode */</span>
                    <br><span class="css-selector">.editable-text.is-editing</span>   <span class="css-comment">/* Container when editing */</span>
                    </div>
                </div>
            </div>
            </section>

            <!-- Loading Screen -->
            <section id="LoadingScreen">
            <div class="card">
                <h2>Loading Screen</h2>

                <div class="loading-doc">
                    <p>
                        The loading screen is designed to <strong>block the UI</strong> while tasks are running.  
                        In a real application, it should only be closed when the process is finished.  
                        For demo purposes, a <span style="color:#dc2626;font-weight:600;">red "hide" button</span> 
                        is displayed in the top-right corner whenever the loading screen is active, so you can
                        manually hide it and continue testing.
                    </p>
                    <p>
                        Use the demo buttons to show the loading screen, seed steps, simulate progress, 
                        or add/remove details. The close button is <em>only for demonstration</em> and 
                        should be removed in production.
                    </p>
                </div>

                <div class="demo-buttons">
                    <button id="ls-show">Show</button>
                    <button id="ls-seed">Seed steps</button>
                    <button id="ls-progress">Simulate progress</button>
                    <button id="ls-add-step">Add step</button>
                    <button id="ls-demo-close">Hide</button>
                    <button id="ls-reset">Reset</button>
                </div>

                <div class="block-js">
                    <span class="js-comment">// Show empty screen</span>
                    <br><span class="js-object">LoadingScreen</span>.<span class="js-func">show</span>();
                    <br><span class="js-object">LoadingScreen</span>.<span class="js-func">update</span>({ main_steps: [], detail: { status: <span class="js-string">'idle'</span> } });
                    <br>
                    <br><span class="js-comment">// Seed a couple of steps</span>
                    <br><span class="js-object">LoadingScreen</span>.<span class="js-func">update</span>({
                    <br>&nbsp;&nbsp;main_steps: [
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Load dataset'</span>, progress: <span class="js-number">0.15</span>, info: <span class="js-string">'12/80'</span> },
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Build index'</span>,  progress: <span class="js-number">0</span> }
                    <br>&nbsp;&nbsp;],
                    <br>&nbsp;&nbsp;detail: { file: <span class="js-string">'data.csv'</span>, splits: <span class="js-number">2</span> }
                    <br>});
                    <br>
                    <br><span class="js-comment">// Update progress over time</span>
                    <br><span class="js-const">let</span> p = <span class="js-number">0</span>;
                    <br><span class="js-object">LoadingScreen</span>.<span class="js-func">update</span>({
                    <br>&nbsp;&nbsp;main_steps: [
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Load dataset'</span>, progress: p, info: <span class="js-string">'0/80'</span> },
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Build index'</span>,  progress: <span class="js-number">0</span> }
                    <br>&nbsp;&nbsp;]
                    <br>});
                    <br>
                    <br><span class="js-comment">// Add a new step</span>
                    <br><span class="js-object">LoadingScreen</span>.<span class="js-func">update</span>({
                    <br>&nbsp;&nbsp;main_steps: [
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Load dataset'</span>, progress: <span class="js-number">0.6</span>, info: <span class="js-string">'48/80'</span> },
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Build index'</span>,  progress: <span class="js-number">0.25</span> },
                    <br>&nbsp;&nbsp;&nbsp;&nbsp;{ title: <span class="js-string">'Warmup cache'</span>, progress: <span class="js-number">0</span> }
                    <br>&nbsp;&nbsp;],
                    <br>&nbsp;&nbsp;detail: { node: <span class="js-string">'A1'</span>, host: <span class="js-string">'example.local'</span> }
                    <br>});
                    <br>
                    <br><span class="js-comment">// Hide</span>
                    <br><span class="js-object">LoadingScreen</span>.<span class="js-func">hide</span>();
                </div>

            </div>
            </section>

            <!-- Navigator -->
            <section id="Navigator">
            <div class="card">
                <h2>Navigator</h2>

                <div class="navigator-doc">
                    <p>
                        The <strong>Navigator</strong> component provides a lightweight tab system: 
                        a navigation bar with multiple tabs and a content area below. 
                        Each tab can hold HTML or DOM nodes, be closable, or even hidden 
                        (so it doesn‚Äôt appear in the bar but can still be opened programmatically).
                    </p>
                    <p>
                        In this demo:
                    </p>
                    <ul>
                        <li>The <strong>Home</strong> tab is permanent and cannot be closed. It also shows a live list of all tabs (visible and hidden).</li>
                        <li>You can add new tabs (regular or closable), open the hidden <em>Reports</em> tab, delete the current tab, or sort all tabs alphabetically with Home pinned first.</li>
                        <li>Tabs created dynamically include placeholder text (‚ÄúLorem ipsum‚Äù) as sample content.</li>
                    </ul>
                    <p>
                        This makes Navigator useful for dashboards, editors, or any app that needs 
                        a flexible tabbed interface with programmatic control over opening, hiding, 
                        and reordering tabs.
                    </p>
                </div>

                <div class="demo-controls" style="display: flex; flex-direction: row; gap: 12px; align-items: flex-end;">
                    <button id="nav-start">Start demo</button>

                    <div class="form-block" style="display: flex; flex-direction: column;">
                        <label for="nav-action" class="sr-only">Action</label>
                        <select id="nav-action" class="form-input" disabled style="margin: 4px 0 0 0;">
                            <option value="add">Add tab</option>
                            <option value="add-closable">Add closable tab</option>
                            <option value="open-hidden">Open hidden ‚ÄúReports‚Äù</option>
                            <option value="delete">Delete current</option>
                            <option value="sort">Sort tabs (A‚ÜíZ)</option>
                            <option value="print">Print visible tabs</option>
                        </select>
                    </div>
                    
                    <button id="nav-run" disabled>Run</button>
                </div>

                <div id="nav-mount"></div>

                <div class="block-js">
                    <span class="js-comment">// 1) Create and draw</span>
                    <br><span class="js-const">const</span> <span class="js-var js-var-def">nav</span> = <span class="js-keyword">new</span> <span class="js-class">Navigator</span>(<span class="js-number">6</span>, <span class="js-string">'Tab limit reached'</span>);
                    <br>nav.<span class="js-func">draw</span>(<span class="js-string">'#nav-mount'</span>);
                    <br>
                    <br><span class="js-comment">// 2) Add tabs (some closable)</span>
                    <br>nav.<span class="js-func">add</span>(<span class="js-string">'tab-A'</span>, <span class="js-string">'A'</span>, <span class="js-string">'&lt;h4&gt;Tab A&lt;/h4&gt;&lt;p&gt;Welcome to A.&lt;/p&gt;'</span>);
                    <br>nav.<span class="js-func">add</span>(<span class="js-string">'tab-B'</span>, <span class="js-string">'B'</span>, <span class="js-string">'&lt;h4&gt;Tab B&lt;/h4&gt;&lt;p&gt;Some content in B.&lt;/p&gt;'</span>);
                    <br>nav.<span class="js-func">add</span>(<span class="js-string">'tab-C'</span>, <span class="js-string">'C'</span>, <span class="js-string">'&lt;h4&gt;Tab C&lt;/h4&gt;&lt;p&gt;Charts, tables‚Ä¶&lt;/p&gt;'</span>, { closable:<span class="js-keyword">true</span> });
                    <br>
                    <br><span class="js-comment">// 3) Hidden tab (no button)</span>
                    <br>nav.<span class="js-func">add_hidden</span>(<span class="js-string">'hidden-reports'</span>, <span class="js-string">'Reports (hidden)'</span>, <span class="js-string">'&lt;h4&gt;Hidden&lt;/h4&gt;&lt;p&gt;Opened programmatically.&lt;/p&gt;'</span>);
                    <br>
                    <br><span class="js-comment">// 4) Open / Set / Delete</span>
                    <br>nav.<span class="js-func">open</span>(<span class="js-string">'tab-B'</span>);
                    <br>nav.<span class="js-func">set</span>(<span class="js-string">'tab-B'</span>, <span class="js-string">'&lt;h4&gt;Updated&lt;/h4&gt;&lt;p&gt;Content replaced.&lt;/p&gt;'</span>);
                    <br>nav.<span class="js-func">delete</span>(<span class="js-string">'tab-A'</span>);
                    <br>
                    <br><span class="js-comment">// 5) Reorder visible tabs</span>
                    <br>nav.<span class="js-func">order</span>([<span class="js-string">'tab-C'</span>, <span class="js-string">'tab-B'</span>]);
                    <br>
                    <br><span class="js-comment">// 6) Print only visible tabs</span>
                    <br>nav.<span class="js-func">print_tabs</span>( nav.<span class="js-func">ids</span>() );
                </div>

                <hr style="border-color: var(--darker-text);"/>

                <div id="quick-start">
                    <h3>Quick Start</h3>
                    <p>
                        Create a navigator, mount it, seed a couple of tabs, and open one:
                    </p>
                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">nav</span> =
                        <span class="js-keyword">new</span> <span class="js-class">Navigator</span>(
                        <span class="js-number">-1</span>,                        <span class="js-comment">// max_tab_number (-1 = no limit)</span>
                        <span class="js-keyword">null</span>,                     <span class="js-comment">// max_tab_message (optional)</span>
                        (<span class="js-var">id</span>) =&gt; {},                 <span class="js-comment">// open_tab_event (optional)</span>
                        (<span class="js-var">id</span>) =&gt; {}                  <span class="js-comment">// delete_event (optional)</span>
                        );
                        <br><span class="js-var">nav</span>.<span class="js-func">draw</span>(<span class="js-string">'#mount'</span>);
                        <br><span class="js-var">nav</span>.<span class="js-func">add</span>(<span class="js-string">'home'</span>, <span class="js-string">'Home'</span>, <span class="js-string">'&lt;h4&gt;Home&lt;/h4&gt;&lt;p&gt;Welcome.&lt;/p&gt;'</span>, { closable:<span class="js-keyword">false</span> });
                        <br><span class="js-var">nav</span>.<span class="js-func">add</span>(<span class="js-string">'logs'</span>, <span class="js-string">'Logs'</span>, <span class="js-string">'&lt;h4&gt;Logs&lt;/h4&gt;&lt;p&gt;Streaming‚Ä¶&lt;/p&gt;'</span>, { closable:<span class="js-keyword">true</span> });
                        <br><span class="js-var">nav</span>.<span class="js-func">open</span>(<span class="js-string">'home'</span>);
                    </div>

                    <!-- ========== Constructor & Mount ========== -->
                    <h3>Constructor &amp; Mount</h3>
                    <p>
                        <code>new Navigator(max_tab_number = -1, max_tab_message = null, open_tab_event = null, delete_event = null)</code><br>
                        Keep it short: set a limit if you need one; if the limit is reached and <em>max_tab_message</em> is provided,
                        <code>add()</code> will not create the tab and will try <em>toast("warning", max_tab_message)</em> if present.
                    </p>
                    <p>
                        <code>draw(target)</code> mounts the component into a container (CSS selector or element). It creates:
                        <em>.navigator</em> ‚Üí <em>.navigator-bar</em> (tab buttons) + <em>.navigator-content</em> (active tab content).
                    </p>

                    <div class="block-js">
                        <span class="js-comment">// Mount into an existing element</span>
                        <br><span class="js-var">nav</span>.<span class="js-func">draw</span>(<span class="js-string">'#mount'</span>);
                    </div>
                </div>
                <br/><br/>
                
                <div id="table-systeme">
                    <!-- ========== Adding & Updating Tabs ========== -->
                    <h3>Adding &amp; Updating Tabs</h3>
                    <p>
                        <code>add(tab_id, tab_name, content, { closable = false, hidden = false, count_towards_limit = true })</code><br>
                        <strong>content</strong> can be an HTML string or a DOM <em>Node</em>. If <em>hidden</em> is true, no button is created,
                        but the tab can still be opened by id. <code>add_hidden(...)</code> is a convenience wrapper.
                    </p>
                    <div class="block-js">
                        <span class="js-comment">// Visible tab, not closable</span>
                        <br><span class="js-var">nav</span>.<span class="js-func">add</span>(<span class="js-string">'overview'</span>, <span class="js-string">'Overview'</span>,
                        <span class="js-string">'&lt;h4&gt;Overview&lt;/h4&gt;&lt;p&gt;Landing content.&lt;/p&gt;'</span>,
                        { closable:<span class="js-keyword">false</span> });
                        <br>
                        <br><span class="js-comment">// Hidden tab (no button in bar)</span>
                        <br><span class="js-var">nav</span>.<span class="js-func">add_hidden</span>(<span class="js-string">'reports'</span>, <span class="js-string">'Reports (hidden)'</span>,
                        <span class="js-string">'&lt;h4&gt;Reports&lt;/h4&gt;&lt;p&gt;Confidential KPIs.&lt;/p&gt;'</span>);
                    </div>

                    <p>
                        <code>set(tab_id, new_content)</code> replaces the inner HTML/Node of an existing tab.
                    </p>
                    <div class="block-js">
                        <span class="js-var">nav</span>.<span class="js-func">set</span>(<span class="js-string">'overview'</span>,
                        <span class="js-string">'&lt;h4&gt;Overview&lt;/h4&gt;&lt;p&gt;Updated at runtime.&lt;/p&gt;'</span>);
                    </div>

                    <!-- ========== Opening & Deleting ========== -->
                    <h3>Opening &amp; Deleting</h3>
                    <p>
                        <code>open(tab_id)</code> activates the tab: highlights the button (if visible) and shows its content.
                        If you provided <em>open_tab_event</em>, it will be called with the opened id.
                    </p>
                    <div class="block-js">
                        <span class="js-var">nav</span>.<span class="js-func">open</span>(<span class="js-string">'reports'</span>);
                    </div>

                    <p>
                        <code>delete(tab_id)</code> removes both the tab button (if any) and the content node.  
                        If the deleted tab was active, the next available tab is opened automatically.
                        If you provided <em>delete_event</em>, it will be called with the deleted id.
                    </p>
                    <div class="block-js">
                        <span class="js-comment">// Guard your own special tabs if needed</span>
                        <br><span class="js-keyword">if</span> (<span class="js-var">nav</span>.<span class="js-var">current</span> !== <span class="js-string">'home'</span>) {
                        <br>&nbsp;&nbsp;<span class="js-var">nav</span>.<span class="js-func">delete</span>(<span class="js-var">nav</span>.<span class="js-var">current</span>);
                        <br>}
                    </div>

                    <!-- ========== Ordering & Listing ========== -->
                    <h3>Ordering &amp; Listing</h3>
                    <p>
                        <code>order(tab_id_list)</code> reorders the <em>visible</em> tab buttons in the bar. Hidden tabs are not affected (no buttons).  
                        <code>ids({ include_hidden = false })</code> returns the list of tab ids (visible only by default; include hidden if you need them).
                    </p>
                    <div class="block-js">
                        <span class="js-comment">// Get visible ids and sort them by label; pin "home" first</span>
                        <br><span class="js-const">const</span> <span class="js-var js-var-def">ids</span> = <span class="js-var">nav</span>.<span class="js-func">ids</span>();  <span class="js-comment">// visible only</span>
                        <br><span class="js-const">const</span> <span class="js-var js-var-def">labeled</span> = <span class="js-var">ids</span>.<span class="js-func">map</span>(id =&gt; ({ id, label: <span class="js-var">nav</span>.<span class="js-var">tabs</span>.<span class="js-func">get</span>(id)?.<span class="js-var">label</span> ?? id }));
                        <br><span class="js-var">labeled</span>.<span class="js-func">sort</span>((a,b) =&gt; a.<span class="js-var">label</span>.<span class="js-func">localeCompare</span>(b.<span class="js-var">label</span>, <span class="js-keyword">undefined</span>, { sensitivity:<span class="js-string">'base'</span> }));
                        <br><span class="js-const">const</span> <span class="js-var js-var-def">homeIdx</span> = <span class="js-var">labeled</span>.<span class="js-func">findIndex</span>(x =&gt; x.<span class="js-var">id</span> === <span class="js-string">'home'</span>);
                        <br><span class="js-keyword">if</span> (<span class="js-var">homeIdx</span> &gt; <span class="js-number">0</span>) { <span class="js-const">const</span> h = <span class="js-var">labeled</span>.<span class="js-func">splice</span>(<span class="js-var">homeIdx</span>, <span class="js-number">1</span>)[<span class="js-number">0</span>]; <span class="js-var">labeled</span>.<span class="js-func">unshift</span>(h); }
                        <br><span class="js-var">nav</span>.<span class="js-func">order</span>( <span class="js-var">labeled</span>.<span class="js-func">map</span>(x =&gt; x.<span class="js-var">id</span>) );
                    </div>

                    <p>
                        To list <em>all</em> tabs (visible + hidden) and inspect their labels/visibility:
                    </p>
                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">all</span> = <span class="js-var">nav</span>.<span class="js-func">ids</span>({ include_hidden:<span class="js-keyword">true</span> });
                        <br><span class="js-const">const</span> <span class="js-var js-var-def">visible</span> = <span class="js-keyword">new</span> <span class="js-class">Set</span>( <span class="js-var">nav</span>.<span class="js-func">ids</span>() );
                        <br><span class="js-const">const</span> <span class="js-var js-var-def">details</span> = <span class="js-var">all</span>.<span class="js-func">map</span>(id =&gt; {
                        <br>&nbsp;&nbsp;<span class="js-const">const</span> t = <span class="js-var">nav</span>.<span class="js-var">tabs</span>.<span class="js-func">get</span>(id);
                        <br>&nbsp;&nbsp;<span class="js-keyword">return</span> { id, label: t?.<span class="js-var">label</span> ?? id, hidden: !<span class="js-var">visible</span>.<span class="js-func">has</span>(id) };
                        <br>});
                    </div>
                </div>
                <br/><br/>

                <div id="event-system">
                    <!-- ========== Events ========== -->
                    <h3>Events</h3>
                    <p>
                        Two optional callbacks are provided at construction:
                        <code>open_tab_event(tab_id)</code> and <code>delete_event(tab_id)</code>.
                        Use them to sync external state (e.g., analytics, router).
                    </p>
                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">navEv</span> =
                        <span class="js-keyword">new</span> <span class="js-class">Navigator</span>(<span class="js-number">-1</span>, <span class="js-keyword">null</span>,
                        (<span class="js-var">id</span>) =&gt; <span class="js-func">console</span>.<span class="js-func">log</span>(<span class="js-string">'opened'</span>, <span class="js-var">id</span>),
                        (<span class="js-var">id</span>) =&gt; <span class="js-func">console</span>.<span class="js-func">log</span>(<span class="js-string">'deleted'</span>, <span class="js-var">id</span>)
                        );
                    </div>
                </div>
                <br/><br/>

                <div class="data-sources-media">
                    <!-- ========== Hydration from HTML ========== -->
                    <h3>Building from HTML</h3>
                    <p>
                        <code>Navigator.from(container, { max_tab_number, max_tab_message, delete_event })</code><br>
                        Build tabs from static markup. Each <em>[data-tab-id]</em> yields one tab; put its content inside
                        <em>.navigator-tab-content</em>. Tabs with <em>data-hidden="true"</em> won‚Äôt get a button.
                    </p>
                    <div class="block-html">
                    &lt;div class="navigator" id="prebuilt"&gt;
                    &nbsp;&nbsp;&lt;div class="navigator-bar"&gt;&lt;/div&gt;
                    &nbsp;&nbsp;&lt;div class="navigator-content"&gt;&lt;/div&gt;
                    &nbsp;&nbsp;&lt;section data-tab-id="home" data-tab-name="Home" data-closable="false"&gt;
                    &nbsp;&nbsp;&nbsp;&nbsp;&lt;div class="navigator-tab-content"&gt;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h4&gt;Home&lt;/h4&gt;&lt;p&gt;Static markup.&lt;/p&gt;
                    &nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;
                    &nbsp;&nbsp;&lt;/section&gt;
                    &nbsp;&nbsp;&lt;section data-tab-id="reports" data-tab-name="Reports" data-hidden="true"&gt;
                    &nbsp;&nbsp;&nbsp;&nbsp;&lt;div class="navigator-tab-content"&gt;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h4&gt;Reports&lt;/h4&gt;&lt;p&gt;Hidden by default.&lt;/p&gt;
                    &nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;
                    &nbsp;&nbsp;&lt;/section&gt;
                    &lt;/div&gt;
                    </div>
                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">navFrom</span> =
                        <span class="js-class">Navigator</span>.<span class="js-func">from</span>( <span class="js-class">document</span>.<span class="js-func">getElementById</span>(<span class="js-string">'prebuilt'</span>), {
                        max_tab_number:<span class="js-number">10</span>,
                        max_tab_message:<span class="js-string">'Limit'</span>,
                        delete_event:(<span class="js-var">id</span>) =&gt; {}
                        });
                        <br><span class="js-var">navFrom</span>.<span class="js-func">open</span>(<span class="js-string">'home'</span>);
                    </div>

                    <!-- ========== Printing ========== -->
                    <h3>Printing</h3>
                    <p>
                        <code>print_tabs(tab_ids, { filename })</code> builds a printable bundle:
                        it reveals hidden <em>display:none</em> fragments, snapshots <em>&lt;canvas&gt;</em> to images,
                        attaches it to the document, sets <em>document.title</em> if given, and calls <em>window.print()</em>.
                    </p>
                    <div class="block-js">
                        <span class="js-var">nav</span>.<span class="js-func">print_tabs</span>( <span class="js-var">nav</span>.<span class="js-func">ids</span>() , { filename:<span class="js-string">'Monthly Report'</span> });
                    </div>
                </div>
                <br/><br/>

                <div id="note">
                    <!-- ========== Notes & Tips ========== -->
                    <h3>Notes &amp; Tips</h3>
                    <ul>
                        <li><strong>Limits:</strong> if <em>max_tab_number</em> is reached and <em>max_tab_message</em> is set, the new tab is ignored and a warning is surfaced via <code>toast("warning", ...)</code> if available.</li>
                        <li><strong>Hidden tabs:</strong> use <code>ids({ include_hidden: true })</code> to audit all tab ids; visible ids only by default.</li>
                        <li><strong>Data access:</strong> the internal map <em>nav.tabs</em> stores <code>{ label, button, content, hidden, count_towards_limit }</code> per id; <em>nav.current</em> holds the current tab id.</li>
                    </ul>
                </div>

            </div>
            </section>

            <!-- PopUp -->
            <section id="PopUp">
            <div class="card">
                <h2>PopUp</h2>
                <div class="demo-buttons">
                    <button id="demo-simple">Simple OK</button>
                    <button id="demo-confirm">Confirm delete</button>
                    <button id="demo-next">Guided step (Next)</button>
                    <button id="demo-showcase">Showcase</button>
                    <button id="demo-custom">Custom content (Node)</button>
                    <button id="demo-locked">Locked (no ESC / no backdrop click)</button>
                    <button id="demo-replace">Replace buttons at runtime</button>
                </div>

                <div id="popup-doc">
                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">pop</span> =
                        <span class="js-keyword">new</span> <span class="js-class">PopUp</span>({
                        <br>&nbsp;&nbsp;content: <span class="js-string">'Hello from PopUp'</span>,
                        <br>&nbsp;&nbsp;buttons: [{ label: <span class="js-string">'OK'</span>, class_name: <span class="js-string">'yes-button'</span> }]
                        <br>}).<span class="js-func">open</span>();
                    </div>

                    <p>
                        The component creates a full-screen wrapper (optionally dimmed), centers a dialog, 
                        and wires ESC/backdrop behaviors depending on your options.
                    </p>

                    <h3>Basics</h3>
                    <p>
                        Instantiate with options; strings are injected as HTML, DOM nodes are inserted as-is. 
                        Backdrop and ESC behaviors are opt-in/out flags. Buttons can be provided up-front or added later.
                    </p>

                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">modal</span> =
                        <span class="js-keyword">new</span> <span class="js-class">PopUp</span>({
                        <br>&nbsp;&nbsp;content: <span class="js-string">'&lt;h4&gt;Title&lt;/h4&gt;&lt;p&gt;Message...&lt;/p&gt;'</span>,
                        <br>&nbsp;&nbsp;backdrop: <span class="js-keyword">true</span>,
                        <br>&nbsp;&nbsp;backdrop_click_closes: <span class="js-keyword">true</span>,
                        <br>&nbsp;&nbsp;esc_closes: <span class="js-keyword">true</span>,
                        <br>&nbsp;&nbsp;buttons: [
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;{ label: <span class="js-string">'Cancel'</span>, class_name: <span class="js-string">'no-button'</span> },
                        <br>&nbsp;&nbsp;&nbsp;&nbsp;{ label: <span class="js-string">'OK'</span>,     class_name: <span class="js-string">'yes-button'</span>, on_click: () =&gt; Toast.<span class="js-func">success</span>(<span class="js-string">'Done'</span>) }
                        <br>&nbsp;&nbsp;],
                        <br>&nbsp;&nbsp;on_open: (inst) =&gt; {}, <span class="js-comment">// dialog is in the DOM</span>
                        <br>&nbsp;&nbsp;on_close: (inst) =&gt; {}
                        <br>});
                        <br><span class="js-var">modal</span>.<span class="js-func">open</span>();
                    </div>

                    <p>Generated structure:</p>
                    <div class="block-html">
                    &lt;div class="pop-up-wrapper" id="pop-up-0"&gt; <br/>
                    &nbsp;&nbsp;&lt;div class="pop-up-backdrop"&gt;&lt;/div&gt;<br/>
                    &nbsp;&nbsp;&lt;div class="pop-up"&gt;<br/>
                    &nbsp;&nbsp;&nbsp;&nbsp;&lt;div class="pop-up-message"&gt;...content...&lt;/div&gt;<br/>
                    &nbsp;&nbsp;&nbsp;&nbsp;&lt;div class="pop-up-buttons"&gt;...buttons...&lt;/div&gt;<br/>
                    &nbsp;&nbsp;&lt;/div&gt;<br/>
                    &lt;/div&gt;
                    </div>

                    <h3>Buttons & callbacks</h3>
                    <p>
                        Each button supports <em>label</em>, optional <em>class_name</em>, optional <em>on_click</em>, and <em>auto_close</em> (default <em>true</em>). 
                        You can rebuild actions at runtime with <em>replace_buttons()</em>.
                    </p>

                    <div class="block-js">
                        <span class="js-const">const</span> <span class="js-var js-var-def">flow</span> =
                        <span class="js-keyword">new</span> <span class="js-class">PopUp</span>({ content: <span class="js-string">'Proceed with action?'</span> });
                        <br><span class="js-var">flow</span>.<span class="js-func">replace_buttons</span>([
                        <br>&nbsp;&nbsp;{ label: <span class="js-string">'Yes'</span>, class_name: <span class="js-string">'yes-button'</span>, on_click: () =&gt; Toast.<span class="js-func">success</span>(<span class="js-string">'OK'</span>) },
                        <br>&nbsp;&nbsp;{ label: <span class="js-string">'No'</span>,  class_name: <span class="js-string">'no-button'</span> }
                        <br>]).<span class="js-func">open</span>();
                    </div>

                    <h3>Shortcuts</h3>
                    <p>
                        Convenience constructors for common flows: quick confirm dialogs, step-by-step prompts, or 
                        a showcase with custom background.
                    </p>

                    <div class="block-js">
                        <span class="js-comment">// Confirm</span>
                        <br><span class="js-class">PopUp</span>.<span class="js-func">confirm</span>(<span class="js-string">'Delete file?'</span>, {
                        <br>&nbsp;&nbsp;yes_label: <span class="js-string">'Delete'</span>, no_label: <span class="js-string">'Cancel'</span>,
                        <br>&nbsp;&nbsp;on_yes: () =&gt; Toast.<span class="js-func">error</span>(<span class="js-string">'Deleted'</span>)
                        <br>}).<span class="js-func">open</span>();
                        <br>
                        <br><span class="js-comment">// Next</span>
                        <br><span class="js-class">PopUp</span>.<span class="js-func">next</span>(<span class="js-string">'Step 1/3'</span>, {
                        <br>&nbsp;&nbsp;text: <span class="js-string">'Continue'</span>,
                        <br>&nbsp;&nbsp;on_next: () =&gt; Toast.<span class="js-func">info</span>(<span class="js-string">'Going next‚Ä¶'</span>),
                        <br>&nbsp;&nbsp;backdrop: <span class="js-keyword">true</span>, backdrop_click_closes: <span class="js-keyword">false</span>
                        <br>}).<span class="js-func">open</span>();
                        <br>
                        <br><span class="js-comment">// Showcase</span>
                        <br><span class="js-class">PopUp</span>.<span class="js-func">showcase</span>(<span class="js-string">'Focus the UI with a dimmed background'</span>).<span class="js-func">open</span>();
                    </div>

                    <h3>Styling hooks</h3>
                    <p>
                        Customize via the base classes below. Add your own button skins using <em>class_name</em>. 
                        Optionally layer a custom background (see <em>extra_backdrop_class</em>).
                    </p>

                    <div class="block-css">
                    <span class="css-selector">.pop-up-wrapper</span>{ <span class="css-property">position</span>: fixed; <span class="css-property">inset</span>: 0; <span class="css-property">z-index</span>: 1000; }
                    <br><span class="css-selector">.pop-up-backdrop</span>{ <span class="css-property">position</span>: absolute; <span class="css-property">inset</span>: 0; <span class="css-property">background</span>: rgba(0,0,0,.45); }
                    <br><span class="css-selector">.pop-up</span>{ <span class="css-property">position</span>: absolute; <span class="css-property">top</span>: 50%; <span class="css-property">left</span>: 50%; <span class="css-property">transform</span>: translate(-50%,-50%); <span class="css-property">min-width</span>: 320px; <span class="css-property">max-width</span>: 90vw; <span class="css-property">border-radius</span>: 10px; <span class="css-property">box-shadow</span>: 0 20px 60px rgba(0,0,0,.25); <span class="css-property">overflow</span>: hidden; <span class="css-property">background</span>: #fff; <span class="css-property">color</span>: #111827; }
                    <br>@media (prefers-color-scheme: dark){ <span class="css-selector">.pop-up</span>{ <span class="css-property">background</span>: #0f172a; <span class="css-property">color</span>: #e5e7eb; } }
                    <br><span class="css-selector">.pop-up-message</span>{ <span class="css-property">padding</span>: 18px 20px; <span class="css-property">font</span>: 500 1rem/1.5 system-ui,-apple-system,Segoe UI,Roboto; }
                    <br><span class="css-selector">.pop-up-buttons</span>{ <span class="css-property">display</span>: flex; <span class="css-property">gap</span>: 8px; <span class="css-property">justify-content</span>: flex-end; <span class="css-property">padding</span>: 12px 14px; <span class="css-property">background</span>: rgba(0,0,0,.04); }
                    <br><span class="css-selector">.pop-up-buttons</span> <span class="css-selector">button</span>{ <span class="css-property">padding</span>: 8px 12px; <span class="css-property">border</span>: 1px solid rgba(0,0,0,.15); <span class="css-property">border-radius</span>: 8px; <span class="css-property">background</span>: #111827; <span class="css-property">color</span>: #fff; <span class="css-property">cursor</span>: pointer; }
                    <br><span class="css-selector">.yes-button</span>{ <span class="css-property">background</span>: #16a34a; <span class="css-property">border-color</span>: #16a34a; }
                    <br><span class="css-selector">.no-button</span>{ <span class="css-property">background</span>: #374151; <span class="css-property">border-color</span>: #374151; }
                    <br><span class="css-selector">.next-button</span>{ <span class="css-property">background</span>: #2563eb; <span class="css-property">border-color</span>: #2563eb; }
                    </div>

                    <p>
                        For an important showcase, layer a custom backdrop:
                    </p>

                    <div class="block-css">
                    <span class="css-selector">.showcase-background</span>{<br/>
                    &nbsp;&nbsp;<span class="css-property">position</span>: absolute; <span class="css-property">inset</span>: 0; <span class="css-property">pointer-events</span>: none;<br/>
                    &nbsp;&nbsp;<span class="css-property">background</span>: radial-gradient(800px 400px at 30% 40%, rgba(255,255,255,.08), transparent 60%),<br/>
                    &nbsp;&nbsp;&nbsp;&nbsp;radial-gradient(600px 300px at 70% 60%, rgba(0,0,0,.25), transparent 50%);<br/>
                    &nbsp;&nbsp;<span class="css-property">filter</span>: blur(8px);<br/>
                    }
                    </div>

                    </div>

            </div>
            </section>

            <!-- Toast -->
            <section id="Toast">
            <div class="card">
                <h2>Toast Notifications</h2>
                <p>
                    Toasts are small notifications displayed at the bottom-right corner of the screen.  
                    They disappear automatically after a short delay.  
                    Each type has a different colored border:
                    <strong>info</strong> (blue), <strong>success</strong> (green),
                    <strong>warning</strong> (orange), <strong>error</strong> (red).
                </p>

                <div class="demo-buttons" style="display: flex; flex-direction: row; gap: 12px;">
                    <button class="btn-info"    onclick="Toast.info('Information message')">Show Info</button>
                    <button class="btn-success" onclick="Toast.success('Operation successful!')">Show Success</button>
                    <button class="btn-warning" onclick="Toast.warning('This is a warning')">Show Warning</button>
                    <button class="btn-error"   onclick="Toast.error('An error occurred!')">Show Error</button>
                </div>

                <div class="toast-doc">
                    <h3>How it works</h3>
                    <p>
                        Use <em>Toast.info</em>, <em>Toast.success</em>, <em>Toast.warning</em>, or <em>Toast.error</em> 
                        to create a toast of the chosen type.  
                        Each call accepts three arguments:
                    </p>

                    <ul>
                        <li><strong>message</strong>: the text of the toast (or raw HTML if <em>opts.html = true</em>).</li>
                        <li><strong>duration</strong>: how long the toast stays visible (default: 3000 ms).</li>
                        <li><strong>opts</strong>: an optional object for extra behavior:
                        <ul>
                            <li><em>pauseOnHover: true</em> ‚Üí the toast won‚Äôt disappear while hovered.</li>
                            <li><em>html: true</em> ‚Üí render the message as HTML instead of plain text.</li>
                        </ul>
                        </li>
                    </ul>

                    <p>Examples:</p>

                    <div class="block-js">
                        <span class="js-comment">// Blue (info)</span>
                        <br>Toast.<span class="js-func">info</span>(<span class="js-string">"Information message"</span>);
                        <br>
                        <br><span class="js-comment">// Green (success)</span>
                        <br>Toast.<span class="js-func">success</span>(<span class="js-string">"Operation successful!"</span>);
                        <br>
                        <br><span class="js-comment">// Orange (warning)</span>
                        <br>Toast.<span class="js-func">warning</span>(<span class="js-string">"Be careful, something is odd‚Ä¶"</span>);
                        <br>
                        <br><span class="js-comment">// Red (error)</span>
                        <br>Toast.<span class="js-func">error</span>(<span class="js-string">"An error occurred!"</span>);
                        <br>
                        <br><span class="js-comment">// Custom duration and opts</span>
                        <br>Toast.<span class="js-func">info</span>(
                        <span class="js-string">"Custom toast"</span>, 
                        <span class="js-number">5000</span>, 
                        { pauseOnHover: <span class="js-keyword">true</span>, html: <span class="js-keyword">false</span> }
                        );
                    </div>
                </div>



            </div>
            </section>

        </div>
    </main>
</body>

<script>
    const { PopUp, Navigator, ContextMenu, EditableText, DataTable, Toast, LoadingScreen } = Toolbox;

    // routing interne + focus
    const sections = Array.from(document.querySelectorAll("section"));
    const navItems = Array.from(document.querySelectorAll("#nav .item"));

    function show(id) {
        sections.forEach(s => s.classList.toggle("active", s.id === id));
        navItems.forEach(a => a.classList.toggle("active", a.getAttribute("href") === "#" + id));
        history.replaceState(null, "", "#" + id)
    }

    function applyFocus(id) {
        sections.forEach(s => s.style.display = (s.id === id ? "" : "none"));
    }

    function clearFocus() {
        sections.forEach(s => s.style.display = "");
    }

    // nav
    window.addEventListener("hashchange", () => {
        const id = location.hash.slice(1) || "ContextMenu";
        show(id);
    });
    navItems.forEach(a => a.addEventListener("click", (e) => {
        e.preventDefault();
        const id = a.getAttribute("href").slice(1);
        show(id);
    }));

    // init route
    show(location.hash.slice(1) || "ContextMenu");
    // --- ContextMenu demo ---
    const context_menu_demo = new ContextMenu({
        activation: 'contextmenu',
        mode: 'selector',
        selector: '#cm-area',

        // Enrich the callback context with useful data
        context_fn: (event, element) => ({ 
            id: element.dataset.id, 
            name: element.dataset.name 
        })
    });
    context_menu_demo
        .action('Cut', () => document.execCommand('cut'))
        .action('Copy', () => document.execCommand('copy'))
        .action('Paste', () => document.execCommand('paste'))
        .sep()
        .action('Select All', () => document.execCommand('selectAll'));

    // --- DataTable demo ---
    // const dtMount = document.getElementById("datatable-mount");
    // const rows = [
    //   { id: 1, name: "Alpha", value: 42 },
    //   { id: 2, name: "Beta", value: 7 },
    //   { id: 3, name: "Gamma", value: 13 },
    // ];
    // const dt = new DataTable({
    //   columns: [
    //     { key: "id", header: "ID" },
    //     { key: "name", header: "Name" },
    //     { key: "value", header: "Value" },
    //   ],
    //   data: rows
    // });
    // dtMount.appendChild(dt.el);
    // document.getElementById("dt-reload").addEventListener("click", () => {
    //   dt.setData(rows.map(r => ({ ...r, value: Math.floor(Math.random()*100) })));
    // });

    // --- EditableText demo ---
    const edMount = document.querySelector("#editable-mount > div");
    const ed = new EditableText({ 
        value: "DEMO TEXT", 
        tag: "span", 
        id: "demo-box",
        on_save: (v) => Toast.success(`Saved: <${v}>`),
        on_cancel: () => Toast.warning("Edit cancelled")
    });
    edMount.innerHTML = `${ed}`;

    // --- PopUp demo ---
    const $ = (id) => document.getElementById(id);

    // 1) Simple OK
    $('demo-simple').addEventListener('click', () => {
        new PopUp({
        content: '<h4>Hi!</h4><p>This is a minimal modal.</p>',
        buttons: [{ label: 'OK', class_name: 'yes-button' }]
        }).open();
    });

    // 2) Confirm delete
    $('demo-confirm').addEventListener('click', () => {
        PopUp.confirm('Delete file <b>report.pdf</b>?', {
        yes_label: 'Delete',
        no_label: 'Cancel',
        on_yes: () => (window.Toast ? Toast.error('Deleted', 3000) : null)
        }).open();
    });

    // 3) Guided step (Next)
    $('demo-next').addEventListener('click', () => {
        PopUp.next('Step 1/3 ‚Äî Read the instructions.', {
        text: 'Next',
        on_next: () => (window.Toast ? Toast.info('Step complete') : null),
        backdrop: true,
        backdrop_click_closes: false
        }).open();
    });

    // 4) Showcase (custom backdrop layer)
    $('demo-showcase').addEventListener('click', () => {
        PopUp.showcase('<h4>Showcase mode</h4><p>Dimmed background to highlight the dialog.</p>')
        .open();
    });

    // 5) Custom content (DOM Node)
    $('demo-custom').addEventListener('click', () => {
        const box = document.createElement('div');
        box.innerHTML = '<h4>Custom content</h4><p>You can pass a Node directly.</p>';
        new PopUp({
        content: box,
        buttons: [
            { label: 'Cancel', class_name: 'no-button' },
            { label: 'OK', class_name: 'yes-button', on_click: () => (window.Toast ? Toast.success('OK') : null) }
        ]
        }).open();
    });

    // 6) Locked modal (no ESC, no backdrop click)
    $('demo-locked').addEventListener('click', () => {
        new PopUp({
        content: '<h4>Locked</h4><p>Close via button only.</p>',
        backdrop: true,
        backdrop_click_closes: false,
        esc_closes: false,
        buttons: [{ label: 'Close', class_name: 'yes-button' }]
        }).open();
    });

    // 7) Replace buttons at runtime
    $('demo-replace').addEventListener('click', () => {
        const pop = new PopUp({
        content: '<h4>Runtime actions</h4><p>Buttons will change after 1.2s.</p>',
        buttons: [{ label: 'Wait‚Ä¶', class_name: 'no-button', auto_close: false }]
        }).open();

        setTimeout(() => {
        pop.replace_buttons([
            { label: 'Cancel', class_name: 'no-button' },
            { label: 'Confirm', class_name: 'yes-button', on_click: () => (window.Toast ? Toast.success('Confirmed') : null) }
        ]);
        pop.set_content('<h4>Runtime actions</h4><p>Buttons replaced.</p>');
        }, 1200);
    });

    // --- LoadingScreen demo ---
    let intervalId=null; let pct=0;

    $('ls-show').addEventListener('click', ()=>{
        LoadingScreen.show();
        LoadingScreen.update({
        main_steps: [],
        detail: { status: 'idle' }
        });
    });

    $('ls-seed').addEventListener('click', ()=>{
        LoadingScreen.show();
        LoadingScreen.update({
        main_steps: [
            { title:'Load dataset', progress: .15, info:'12/80' },
            { title:'Build index',  progress: 0   }
        ],
        detail: { file:'data.csv', splits:2 }
        });
    });

    $('ls-progress').addEventListener('click', ()=>{
        LoadingScreen.show();
        pct=0;
        clearInterval(intervalId);
        intervalId=setInterval(()=>{
        pct=Math.min(1, pct+0.08);
        LoadingScreen.update({
            main_steps:[
            { title:'Load dataset', progress:pct, info:`${Math.round(pct*80)}/80` },
            { title:'Build index',  progress: Math.max(0, pct-0.4) }
            ],
            detail:{ status: pct<1?'loading':'done' }
        });
        if(pct>=1){ clearInterval(intervalId); }
        }, 350);
    });

    $('ls-add-step').addEventListener('click', ()=>{
        LoadingScreen.show();
        LoadingScreen.update({
        main_steps:[
            { title:'Load dataset', progress:.6, info:'48/80' },
            { title:'Build index',  progress:.25 },
            { title:'Warmup cache', progress:0 }
        ],
        detail:{ node:'A1', host: location.hostname }
        });
    });

    $('ls-reset').addEventListener('click', ()=>{
        LoadingScreen.show();
        LoadingScreen.update({ main_steps:[], detail:{} });
        clearInterval(intervalId); pct=0;
    });

    const demoCloseBtn = $('ls-demo-close');

    demoCloseBtn.addEventListener('click', () => {
        LoadingScreen.hide();
        demoCloseBtn.style.display = 'none';
    });

    // Hook show/hide
    const origShow = LoadingScreen.show.bind(LoadingScreen);
        LoadingScreen.show = function() {
        origShow();
        demoCloseBtn.style.display = 'block';
        console.log("LoadingScreen shown, demoCloseBtn visible");
    };

    const origHide = LoadingScreen.hide.bind(LoadingScreen);
        LoadingScreen.hide = function() {
        origHide();
        demoCloseBtn.style.display = 'none';
    };

    let nav = null
    const ui = {
        start:  $('nav-start'),
        action: $('nav-action'),
        run:    $('nav-run'),
        mount:  $('nav-mount'),
    };

    // Lorem generator (simple)
    const lipsum = () =>
        'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere, ' +
        'nibh at viverra pulvinar, neque sapien faucibus mauris, eu accumsan nunc ' +
        'massa in elit. Sed non laoreet arcu.';

    // Met √† jour le contenu de la tab "home" avec la liste des tabs
    function renderHomeList() {
        if (!nav) return;
        const allIds = nav.ids({ include_hidden: true });
        const visibleIds = new Set(nav.ids()); // visibles
        const items = allIds.map(id => {
        const t = nav.tabs.get(id);
        const isHidden = !visibleIds.has(id);
        const badge = isHidden ? '<span class="pill">hidden</span>' : '<span class="pill">visible</span>';
        const current = (id === nav.current) ? ' <em>(current)</em>' : '';
        const label = t?.label ?? id;
        return `<li><strong>${label}</strong> <small>#${id}</small> ${badge}${current}</li>`;
        }).join('');

        const html =
        `<h4>Home</h4>
        <p>This is the landing tab. It lists all tabs (including hidden ones).</p>
        <ul class="home-tab-list">${items}</ul>`;

        // Si la tab home existe, remplace son contenu, sinon rien
        const home = nav.tabs.get('home');
        if (home) nav.set('home', html);
    }

    // Tri A‚ÜíZ (home en premier), uniquement les tabs visibles (ordre visuel)
    function sortVisibleTabsAZ() {
        if (!nav) return;
        const ids = nav.ids(); // visibles
        const withLabels = ids.map(id => ({ id, label: nav.tabs.get(id)?.label ?? id }));
        withLabels.sort((a, b) => a.label.localeCompare(b.label, undefined, { sensitivity: 'base' }));

        // Place "home" en premier si pr√©sent
        const homeIdx = withLabels.findIndex(x => x.id === 'home');
        if (homeIdx > 0) {
        const [homeItem] = withLabels.splice(homeIdx, 1);
        withLabels.unshift(homeItem);
        }

        nav.order(withLabels.map(x => x.id));
    }

    // Hook utilitaire pour rafra√Æchir la liste "home" apr√®s chaque action
    function hookRefreshers() {
        if (!nav) return;
        // Wrap open to refresh "current" indicator
        const origOpen = nav.open.bind(nav);
        nav.open = function(id) {
        origOpen(id);
        renderHomeList();
        };
        // Wrap delete to refresh
        const origDelete = nav.delete.bind(nav);
        nav.delete = function(id) {
        // Protection: ne jamais supprimer home
        if (id === 'home') {
            if (window.Toast) Toast.warning('Cannot delete "home"');
            else alert('Cannot delete "home"');
            return;
        }
        origDelete(id);
        renderHomeList();
        };
        // Wrap add/add_hidden/set/order to refresh list
        const origAdd = nav.add.bind(nav);
        nav.add = function(tab_id, tab_name, content, opts) {
        origAdd(tab_id, tab_name, content, opts);
        renderHomeList();
        };
        const origAddHidden = nav.add_hidden.bind(nav);
        nav.add_hidden = function(tab_id, tab_name, content, opts) {
        origAddHidden(tab_id, tab_name, content, opts);
        renderHomeList();
        };
        const origSet = nav.set.bind(nav);
        nav.set = function(tab_id, new_content) {
        origSet(tab_id, new_content);
        if (tab_id === 'home') return; // √©viter boucle
        renderHomeList();
        };
        const origOrder = nav.order.bind(nav);
        nav.order = function(list) {
        origOrder(list);
        renderHomeList();
        };
    }

    // ----- UI wiring -----
    ui.start.addEventListener('click', () => {
        ui.mount.innerHTML = '';
        // Pas de "stats" au seed
        nav = new Navigator(8, 'Tab limit reached');
        nav.draw('#nav-mount');

        // Seed: home (non closable), logs (closable)
        nav.add('home', 'Home',
        `<h4>Home</h4>
        <p>Welcome. This tab lists all tabs below.</p>
        <ul class="home-tab-list"></ul>`,
        { closable: false }
        );
        nav.add('logs', 'Logs',
        `<h4>Logs</h4><p>${lipsum()}</p>`,
        { closable: true }
        );

        hookRefreshers();
        renderHomeList();

        // Enable controls
        ui.action.disabled = false;
        ui.run.disabled = false;
        ui.start.disabled = true;
    });

    ui.run.addEventListener('click', () => {
        if (!nav) return;
        const action = ui.action.value;

        switch (action) {
        case 'add': {
            const id = 'tab-' + Math.random().toString(36).slice(2,6);
            nav.add(id, id.toUpperCase(),
            `<h4>${id.toUpperCase()}</h4><p>${lipsum()}</p>`,
            { closable: false }
            );
            nav.open(id);
            break;
        }
        case 'add-closable': {
            const id = 'tab-' + Math.random().toString(36).slice(2,6);
            nav.add(id, id.toUpperCase(),
            `<h4>${id.toUpperCase()}</h4><p>${lipsum()}</p>`,
            { closable: true }
            );
            nav.open(id);
            break;
        }
        case 'open-hidden': {
            if (!nav.ids({ include_hidden:true }).includes('reports')) {
            nav.add_hidden('reports', 'Reports (hidden)',
                `<h4>Reports</h4><p>${lipsum()}</p>`);
            }
            nav.open('reports');
            break;
        }
        case 'delete': {
            if (!nav.current) return;
            // Protection d√©j√† dans nav.delete hook, mais on redouble ici
            if (nav.current === 'home') {
            if (window.Toast) Toast.warning('Cannot delete "home"');
            else alert('Cannot delete "home"');
            return;
            }
            nav.delete(nav.current);
            break;
        }
        case 'sort': {
            sortVisibleTabsAZ();
            break;
        }
        case 'print': {
            nav.print_tabs(nav.ids());
            break;
        }
        }
    });
</script>

</html>